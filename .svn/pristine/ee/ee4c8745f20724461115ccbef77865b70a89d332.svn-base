#pragma checksum "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\Controls\SearchBar.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "bd791690ea2ffc146d1374e9631677c2d1796d9b"
// <auto-generated/>
#pragma warning disable 1591
namespace BlazorServerApp.Controls
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using BlazorServerApp;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using BlazorServerApp.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using Blazored.LocalStorage;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using BlazorServerApp.Data;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using ShoppingCart.UseCases.SearchProductScreen;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using ShoppingCart.UseCases.ViewProductScreen;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using ShoppingCart.UseCases.CartScreen;

#line default
#line hidden
#nullable disable
#nullable restore
#line 16 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using ShoppingCart.UseCases.LoginScreen;

#line default
#line hidden
#nullable disable
#nullable restore
#line 17 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using ShoppingCart.CoreBusiness.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 19 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using BlazorServerApp.Controls;

#line default
#line hidden
#nullable disable
#nullable restore
#line 21 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using Radzen;

#line default
#line hidden
#nullable disable
#nullable restore
#line 22 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using Radzen.Blazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 23 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using ShoppingCart.UseCases.RegisterScreen;

#line default
#line hidden
#nullable disable
#nullable restore
#line 24 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using ShoppingCart.UseCases.FavProductScreen;

#line default
#line hidden
#nullable disable
#nullable restore
#line 26 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using System.IO;

#line default
#line hidden
#nullable disable
#nullable restore
#line 27 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using System.Configuration;

#line default
#line hidden
#nullable disable
#nullable restore
#line 29 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using Microsoft.Extensions.Configuration;

#line default
#line hidden
#nullable disable
#nullable restore
#line 30 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using Microsoft.Extensions.Options;

#line default
#line hidden
#nullable disable
#nullable restore
#line 31 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\_Imports.razor"
using System.Web;

#line default
#line hidden
#nullable disable
    public partial class SearchBar : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
            __builder.OpenElement(0, "div");
            __builder.AddAttribute(1, "class", "row mt-5 mt-md-4 my-2");
            __builder.AddMarkupContent(2, "\r\n    ");
            __builder.OpenElement(3, "div");
            __builder.AddAttribute(4, "class", "col-md-4 d-inline-flex centerCol");
            __builder.AddMarkupContent(5, "\r\n        ");
            __builder.OpenElement(6, "div");
            __builder.AddAttribute(7, "class", "dropdown w-100 text-left");
            __builder.AddMarkupContent(8, "\r\n            ");
            __builder.AddMarkupContent(9, "<button class=\"btn proCategoriesBtn dropdown-toggle text-left\" type=\"button\" data-toggle=\"dropdown\">\r\n                Shop by Category\r\n                <span class=\"caret\"></span>\r\n            </button>\r\n            ");
            __builder.OpenElement(10, "ul");
            __builder.AddAttribute(11, "class", "proCat dropdown-menu");
            __builder.AddMarkupContent(12, "\r\n");
#nullable restore
#line 19 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\Controls\SearchBar.razor"
                 if (allCategories != null)
                {

#line default
#line hidden
#nullable disable
            __builder.AddContent(13, "                    ");
            __builder.OpenElement(14, "li");
            __builder.OpenComponent<Microsoft.AspNetCore.Components.Routing.NavLink>(15);
            __builder.AddAttribute(16, "class", "dropdown-item");
            __builder.AddAttribute(17, "href", 
#nullable restore
#line 21 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\Controls\SearchBar.razor"
                                                               $"/searchPage/null/-1"

#line default
#line hidden
#nullable disable
            );
            __builder.AddAttribute(18, "ChildContent", (Microsoft.AspNetCore.Components.RenderFragment)((__builder2) => {
                __builder2.AddContent(19, "All Categories");
            }
            ));
            __builder.CloseComponent();
            __builder.CloseElement();
            __builder.AddMarkupContent(20, "\r\n");
#nullable restore
#line 23 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\Controls\SearchBar.razor"
                     foreach (var cateogry in allCategories)
                    {

#line default
#line hidden
#nullable disable
            __builder.AddContent(21, "                        ");
            __builder.OpenElement(22, "li");
            __builder.OpenComponent<Microsoft.AspNetCore.Components.Routing.NavLink>(23);
            __builder.AddAttribute(24, "class", "dropdown-item");
            __builder.AddAttribute(25, "href", 
#nullable restore
#line 25 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\Controls\SearchBar.razor"
                                                                   $"/searchPage/null/"+cateogry.CategoryId

#line default
#line hidden
#nullable disable
            );
            __builder.AddAttribute(26, "ChildContent", (Microsoft.AspNetCore.Components.RenderFragment)((__builder2) => {
                __builder2.AddContent(27, 
#nullable restore
#line 25 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\Controls\SearchBar.razor"
                                                                                                               cateogry.Name

#line default
#line hidden
#nullable disable
                );
            }
            ));
            __builder.CloseComponent();
            __builder.CloseElement();
            __builder.AddMarkupContent(28, "\r\n");
#nullable restore
#line 26 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\Controls\SearchBar.razor"
                    }

#line default
#line hidden
#nullable disable
#nullable restore
#line 26 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\Controls\SearchBar.razor"
                     
                }

#line default
#line hidden
#nullable disable
            __builder.AddContent(29, "            ");
            __builder.CloseElement();
            __builder.AddMarkupContent(30, "\r\n        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(31, "\r\n    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(32, "\r\n    ");
            __builder.OpenElement(33, "div");
            __builder.AddAttribute(34, "class", "col-md-8 text-center d-inline-flex");
            __builder.AddMarkupContent(35, "\r\n        ");
            __builder.OpenElement(36, "div");
            __builder.AddAttribute(37, "id", "searchBox");
            __builder.AddAttribute(38, "class", "mt-2 mt-md-0");
            __builder.AddMarkupContent(39, "\r\n");
#nullable restore
#line 33 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\Controls\SearchBar.razor"
             if (!isNewPage)
            {

#line default
#line hidden
#nullable disable
            __builder.AddContent(40, "                ");
            __builder.OpenElement(41, "input");
            __builder.AddAttribute(42, "type", "text");
            __builder.AddAttribute(43, "placeholder", "Search....");
            __builder.AddAttribute(44, "id", "searchBox");
            __builder.AddAttribute(45, "class", "form-control mr-2");
            __builder.AddAttribute(46, "onkeyup", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.KeyboardEventArgs>(this, 
#nullable restore
#line 35 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\Controls\SearchBar.razor"
                                                                                                                                                                     Search

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(47, "value", Microsoft.AspNetCore.Components.BindConverter.FormatValue(
#nullable restore
#line 35 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\Controls\SearchBar.razor"
                                                                                                                  searchValue

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(48, "oninput", Microsoft.AspNetCore.Components.EventCallback.Factory.CreateBinder(this, __value => searchValue = __value, searchValue));
            __builder.SetUpdatesAttributeName("value");
            __builder.CloseElement();
            __builder.AddMarkupContent(49, "\r\n");
#nullable restore
#line 36 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\Controls\SearchBar.razor"
            }
            else
            {

#line default
#line hidden
#nullable disable
            __builder.AddContent(50, "                ");
            __builder.OpenElement(51, "input");
            __builder.AddAttribute(52, "type", "text");
            __builder.AddAttribute(53, "placeholder", "Search....");
            __builder.AddAttribute(54, "id", "searchBox");
            __builder.AddAttribute(55, "class", "form-control mr-2");
            __builder.AddAttribute(56, "onkeyup", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.KeyboardEventArgs>(this, 
#nullable restore
#line 39 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\Controls\SearchBar.razor"
                                                                                                                                         Enter

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(57, "value", Microsoft.AspNetCore.Components.BindConverter.FormatValue(
#nullable restore
#line 39 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\Controls\SearchBar.razor"
                                                                                                                  searchValue

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(58, "onchange", Microsoft.AspNetCore.Components.EventCallback.Factory.CreateBinder(this, __value => searchValue = __value, searchValue));
            __builder.SetUpdatesAttributeName("value");
            __builder.CloseElement();
            __builder.AddMarkupContent(59, "\r\n");
#nullable restore
#line 40 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\Controls\SearchBar.razor"
            }

#line default
#line hidden
#nullable disable
            __builder.AddContent(60, "            ");
            __builder.OpenElement(61, "button");
            __builder.AddAttribute(62, "class", "btn");
            __builder.AddAttribute(63, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 41 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\Controls\SearchBar.razor"
                                          Search

#line default
#line hidden
#nullable disable
            ));
            __builder.AddMarkupContent(64, "<i class=\"topIcons fas fa-search\"></i>");
            __builder.CloseElement();
            __builder.AddMarkupContent(65, "\r\n        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(66, "\r\n    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(67, "\r\n");
            __builder.CloseElement();
        }
        #pragma warning restore 1998
#nullable restore
#line 47 "D:\Documents\Bellvantage\Mother Sri Lanka_SVN\BlazorServerApp\Controls\SearchBar.razor"
       

    private IEnumerable<Outlet> outlets { get; set; }
    private int selectedOutletId;
    private IEnumerable<Product> allProducts { get; set; }
    private List<Product> currentfavproducts = new List<Product>();
    private IEnumerable<Category> allCategories { get; set; }
    private List<Product> newfavproducts;
    private User user;

    [Parameter]
    public string searchValue { get; set; }

    [Parameter]
    public EventCallback<string> OnSearch { get; set; }

    [Parameter]
    public EventCallback<string> OnOutletSelect { get; set; }

    [Parameter]
    public bool isNewPage { get; set; }

    protected override async Task OnInitializedAsync()
    {
        outlets = (await OutletService.GetAllOutlets());
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            allCategories = (await CategoryService.GetAllCategories()).ToList();
            user = await localStore.GetItemAsync<User>("user");
            selectedOutletId = await localStore.GetItemAsync<int>("outlet");
            StateHasChanged();
        }
    }

    private void Search()
    {
        if (isNewPage)
        {
            if (searchValue == String.Empty || searchValue == null)
            {
                NavManager.NavigateTo("/searchPage/null/-1");
            }
            else
            {
                NavManager.NavigateTo("/searchPage/" + searchValue + "/-1");
            }
        }
        else
        {
            OnSearch.InvokeAsync(searchValue);
        }
    }

    public void Enter(KeyboardEventArgs e)
    {
        if (e.Code == "Enter" || e.Code == "NumpadEnter")
        {
            Search();
        }
    }

    private void OutletSelect(ChangeEventArgs e)
    {
        OnOutletSelect.InvokeAsync(e.Value.ToString());
        SaveSelectedOutlet(Convert.ToInt32(e.Value.ToString()));
    }

    private void OnChange(object args)
    {
        OnOutletSelect.InvokeAsync(args.ToString());
        SaveSelectedOutlet(Convert.ToInt32(args.ToString()));
    }

    private async void SaveSelectedOutlet(int outletIt)
    {
        appState.SetCartItemCount(0);
        cartService.EmptyCart();
        await localStore.SetItemAsync("outlet", outletIt);
        if (user != null)
        {
            await localStore.RemoveItemAsync("cart-" + user.CustomerId);
        }
        else
        {
            await localStore.RemoveItemAsync("cart-0");
        }

        UpdateFavorite(outletIt);
    }

    private async void UpdateFavorite(int outletid)
    {
        newfavproducts = new List<Product>();

        allProducts = (await ProductService.GetProductsByOutletId(outletid)).ToList();
        if (user != null)
        {
            currentfavproducts = await localStore.GetItemAsync<List<Product>>("fav-" + user.CustomerId);
        }
        else
        {
            currentfavproducts = await localStore.GetItemAsync<List<Product>>("fav-0");
        }

        if (currentfavproducts != null)
        {
            foreach (var currentproduct in currentfavproducts)
            {
                foreach (var allproducts in allProducts)
                {

                    if (allproducts.productId == currentproduct.productId)
                    {
                        newfavproducts.Add(allproducts);
                    }
                }
            }
        }

        favProduct.EmptyFav();
        favProduct.SetFav(newfavproducts);
        appState.SetFavProductCount(favProduct.GetTotalCount());
        if (user != null)
        {
            await localStore.RemoveItemAsync("fav-" + user.CustomerId);
            await localStore.SetItemAsync("fav-" + user.CustomerId, newfavproducts);
        }
        else
        {
            await localStore.RemoveItemAsync("fav-0");
            await localStore.SetItemAsync("fav-0", newfavproducts);
        }
        StateHasChanged();
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private ICartService cartService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IFavProduct favProduct { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private ICategoryService CategoryService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IProductService ProductService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime JSRuntime { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private AppState appState { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IOutletService OutletService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private ILocalStorageService localStore { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private NavigationManager NavManager { get; set; }
    }
}
#pragma warning restore 1591
