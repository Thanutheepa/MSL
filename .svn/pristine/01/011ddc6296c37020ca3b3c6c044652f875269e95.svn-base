// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace BlazorServerApp.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "D:\MSL\BlazorServerApp\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "D:\MSL\BlazorServerApp\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "D:\MSL\BlazorServerApp\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "D:\MSL\BlazorServerApp\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "D:\MSL\BlazorServerApp\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "D:\MSL\BlazorServerApp\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "D:\MSL\BlazorServerApp\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "D:\MSL\BlazorServerApp\_Imports.razor"
using BlazorServerApp;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "D:\MSL\BlazorServerApp\_Imports.razor"
using BlazorServerApp.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "D:\MSL\BlazorServerApp\_Imports.razor"
using Blazored.LocalStorage;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "D:\MSL\BlazorServerApp\_Imports.razor"
using BlazorServerApp.Data;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "D:\MSL\BlazorServerApp\_Imports.razor"
using ShoppingCart.UseCases.SearchProductScreen;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "D:\MSL\BlazorServerApp\_Imports.razor"
using ShoppingCart.UseCases.ViewProductScreen;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "D:\MSL\BlazorServerApp\_Imports.razor"
using ShoppingCart.UseCases.CartScreen;

#line default
#line hidden
#nullable disable
#nullable restore
#line 16 "D:\MSL\BlazorServerApp\_Imports.razor"
using ShoppingCart.UseCases.LoginScreen;

#line default
#line hidden
#nullable disable
#nullable restore
#line 17 "D:\MSL\BlazorServerApp\_Imports.razor"
using ShoppingCart.CoreBusiness.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 19 "D:\MSL\BlazorServerApp\_Imports.razor"
using BlazorServerApp.Controls;

#line default
#line hidden
#nullable disable
#nullable restore
#line 21 "D:\MSL\BlazorServerApp\_Imports.razor"
using Radzen;

#line default
#line hidden
#nullable disable
#nullable restore
#line 22 "D:\MSL\BlazorServerApp\_Imports.razor"
using Radzen.Blazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 23 "D:\MSL\BlazorServerApp\_Imports.razor"
using ShoppingCart.UseCases.RegisterScreen;

#line default
#line hidden
#nullable disable
#nullable restore
#line 24 "D:\MSL\BlazorServerApp\_Imports.razor"
using ShoppingCart.UseCases.FavProductScreen;

#line default
#line hidden
#nullable disable
#nullable restore
#line 26 "D:\MSL\BlazorServerApp\_Imports.razor"
using System.IO;

#line default
#line hidden
#nullable disable
#nullable restore
#line 27 "D:\MSL\BlazorServerApp\_Imports.razor"
using System.Configuration;

#line default
#line hidden
#nullable disable
#nullable restore
#line 29 "D:\MSL\BlazorServerApp\_Imports.razor"
using Microsoft.Extensions.Configuration;

#line default
#line hidden
#nullable disable
#nullable restore
#line 30 "D:\MSL\BlazorServerApp\_Imports.razor"
using Microsoft.Extensions.Options;

#line default
#line hidden
#nullable disable
#nullable restore
#line 31 "D:\MSL\BlazorServerApp\_Imports.razor"
using System.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "D:\MSL\BlazorServerApp\Pages\SetEditShippingAddress.razor"
using System.Text.RegularExpressions;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/MyShippingAddress/{status}")]
    public partial class SetEditShippingAddress : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 155 "D:\MSL\BlazorServerApp\Pages\SetEditShippingAddress.razor"
       
    [Parameter]
    public string Status { get; set; }

    private int Id;
    private int CustomerId;
    private string AdNo;
    private string AdRoad;
    private string AdCity;
    private string Province = "";
    private string Country = "";
    private string MobileNo = "";
    private string LandNo = "";
    private string EmailAddress;
    private string PostalCode = "";
    private string Longitude = "";
    private string Latitude = "";
    private string UserName;
    private string FullAddress;
    private int District = 0;
    private int billingid;
    private int result;
    int resultstatus = 1;
    private string errorMessage = "";
    private string emailerror = "";
    private string phonenoerror = "";
    private string landnoerror = "";

    private List<Country> countryList { get; set; }
    private List<State> stateList { get; set; }
    private Address setShippingAddress = new Address();
    private List<Address> getShippingAddress = new List<Address>();

    List<string> countires = new List<string>() { "SriLanka", "Australia", "United Kingdom", "New Zealand" };
    List<string> provinces = new List<string>() { "Western province", "Central province", "Southern province", "Uva province", "Sabaragamuwa province", "North western province", "North central province", "Northern province", "eastern province" };

    public User user { get; set; }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JSRuntime.InvokeAsync<object>("NavBarFixed");
            countryList = new List<Country>();
            countryList = (await apiService.GetCountries()).ToList();
            user = await localStore.GetItemAsync<User>("user");
            appState.SetUser(user);
            CustomerId = appState.user.CustomerId;
            UserName = appState.user.UserName;
            EmailAddress = appState.user.UserName;

            if (Status != "set")
            {
                var customershipping = Task.Run(async () => await ProfileService.GetCustomerShipping(CustomerId));
                getShippingAddress = customershipping.Result;

                foreach (var shippingaddress in getShippingAddress)
                {
                    if (shippingaddress.Id == Convert.ToInt32(Status))
                    {
                        Id = shippingaddress.Id;
                        AdNo = shippingaddress.AdNo;
                        AdCity = shippingaddress.AdCity;
                        AdRoad = shippingaddress.AdRoad;
                        Province = shippingaddress.Province;
                        Country = shippingaddress.Country;
                        MobileNo = shippingaddress.MobileNo;
                        if (shippingaddress.LandNo == "0")
                        {
                            LandNo = "";
                        }
                        else
                        {
                            LandNo = "0" + shippingaddress.LandNo;
                        }

                        PostalCode = shippingaddress.PostalCode.ToString();

                        if (PostalCode == "0")
                        {
                            PostalCode = "";
                        }

                        FullAddress = shippingaddress.FullAddress;
                    }
                }

            }
            //  CustomerId = appState.user.CustomerId;
            //  UserName = appState.user.UserName;
            //  EmailAddress = appState.user.UserName;
            StateHasChanged();
        }
    }

    protected override async void OnInitialized()
    {
        base.OnInitialized();

        //  user = login.GetUsers();
        //user = await localStore.GetItemAsync<User>("user");
        //appState.SetUser(user);
    }

    protected void HandleSet()
    {
        resultstatus = 1;
        errorMessage = "";
        emailerror = "";
        phonenoerror = "";
        landnoerror = "";

        if (AdNo == string.Empty || AdNo == null || AdCity == string.Empty || AdCity == null || Country == string.Empty || Country == null || MobileNo == string.Empty || MobileNo == null || EmailAddress == string.Empty || EmailAddress == null || PostalCode == string.Empty || PostalCode == null || Province == string.Empty || Province == null)
        {
            resultstatus = 0;
            errorMessage = "Fill the all the required fields";
        }

        else
        {
            if (EmailValidate() == false)
            {
                resultstatus = 0;
                emailerror = "Email address is invalid!";
                EmailAddress = "";
            }

            if (LandNo != string.Empty)
            {
                if (LandPhoneValidate() == false)
                {
                    resultstatus = 0;
                    landnoerror = "Land phone number is invalid!";
                    LandNo = "";
                }
            }

            if (PhoneValidate() == false)
            {
                resultstatus = 0;
                phonenoerror = "Phone number is invalid!";
                MobileNo = "";
            }

            else if (resultstatus == 1)
            {
                resultstatus = 1;
                setShippingAddress.Id = 0;
                setShippingAddress.CustomerId = CustomerId;
                setShippingAddress.AdNo = AdNo;
                setShippingAddress.AdCity = AdCity;
                setShippingAddress.AdRoad = AdRoad;
                setShippingAddress.Province = Province;
                setShippingAddress.Country = Country;
                setShippingAddress.MobileNo = MobileNo;

                if (LandNo == null)
                {
                    LandNo = "";
                }

                setShippingAddress.LandNo = LandNo;
                setShippingAddress.EmailAddress = EmailAddress;
                if (PostalCode == "")
                {
                    setShippingAddress.PostalCode = 0;
                }
                else
                {
                    setShippingAddress.PostalCode = Convert.ToInt32(PostalCode);
                }
                setShippingAddress.Longitude = Longitude;
                setShippingAddress.Latitude = Latitude;
                setShippingAddress.UserName = UserName;
                FullAddress = "No " + AdNo + ", " + AdRoad + ", " + AdCity;
                setShippingAddress.FullAddress = FullAddress;
                setShippingAddress.District = District;

                var customershipping = Task.Run(async () => await ProfileService.CreateCustomerShipping(setShippingAddress));
                billingid = customershipping.Result;

                if (billingid > 0)
                {
                    NavManager.NavigateTo("/MyAddress");
                }
                else
                {
                    Id = 0;
                    AdNo = "";
                    AdRoad = "";
                    AdCity = "";
                    Province = "";
                    Country = "";
                    MobileNo = "";
                    LandNo = "";
                    PostalCode = "";
                    Longitude = "";
                    Latitude = "";
                    FullAddress = "";

                    resultstatus = 0;
                    errorMessage = "Something wrong! Please Resubmit";
                }

            }

        }
    }

    protected void HandleEdit()
    {
        resultstatus = 1;
        errorMessage = "";
        emailerror = "";
        phonenoerror = "";
        landnoerror = "";

        if (AdNo == string.Empty || AdNo == null || AdRoad == string.Empty || AdRoad == null || AdCity == string.Empty || AdCity == null || Province == string.Empty || Province == null || Country == string.Empty || Country == null || MobileNo == string.Empty || MobileNo == null || EmailAddress == string.Empty || EmailAddress == null)
        {
            resultstatus = 0;
            errorMessage = "Fill the all the required fields";
        }

        else
        {
            if (EmailValidate() == false)
            {
                resultstatus = 0;
                emailerror = "Email address is invalid!";
                EmailAddress = "";
            }

            if (LandNo != string.Empty)
            {
                if (LandPhoneValidate() == false)
                {
                    resultstatus = 0;
                    landnoerror = "Land phone number is invalid!";
                    LandNo = "";
                }
            }

            if (PhoneValidate() == false)
            {
                resultstatus = 0;
                phonenoerror = "Phone number is invalid!";
                MobileNo = "";
            }

            else if (resultstatus == 1)
            {
                setShippingAddress.Id = Id;
                setShippingAddress.CustomerId = CustomerId;
                setShippingAddress.AdNo = AdNo;
                setShippingAddress.AdCity = AdCity;
                setShippingAddress.AdRoad = AdRoad;
                setShippingAddress.Province = Province;
                setShippingAddress.Country = Country;
                setShippingAddress.MobileNo = MobileNo;
                if (LandNo == null)
                {
                    LandNo = "";
                }
                setShippingAddress.LandNo = LandNo;
                setShippingAddress.EmailAddress = EmailAddress;

                if (PostalCode == "")
                {
                    setShippingAddress.PostalCode = 0;
                }
                else
                {
                    setShippingAddress.PostalCode = Convert.ToInt32(PostalCode);
                }

                setShippingAddress.Longitude = Longitude;
                setShippingAddress.Latitude = Latitude;
                setShippingAddress.UserName = UserName;
                FullAddress = "No " + AdNo + ", " + AdRoad + ", " + AdCity;
                setShippingAddress.FullAddress = FullAddress;
                setShippingAddress.District = District;

                var customershipping = Task.Run(async () => await ProfileService.UpdateCustomerShipping(setShippingAddress));
                result = customershipping.Result;

                NavManager.NavigateTo("/MyAddress");

                if (result == 200)
                {
                    NavManager.NavigateTo("/MyAddress");
                }
                else
                {
                    resultstatus = 0;
                    errorMessage = "Something wrong! Please Resubmit";
                }
            }
        }

    }

    void ShowNotification(NotificationMessage message)
    {
        NotificationService.Notify(message);
    }

    private bool EmailValidate()
    {

        if (Regex.IsMatch(EmailAddress, @"\A(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?)\Z", RegexOptions.IgnoreCase))
        {
            return true;
        }
        else return false;
    }

    private bool PhoneValidate()
    {
        Regex phone = new Regex("[0-9]{10}");
        if (phone.IsMatch(MobileNo))
        {
            return true;
        }
        else
        {
            return false;
        }
    }

    private bool LandPhoneValidate()
    {
        Regex phone = new Regex("[0-9]{10}");
        if (phone.IsMatch(LandNo))
        {
            return true;
        }
        else
        {
            return false;
        }
    }

    private void OnCountryChange()
    {
        stateList = new List<State>();
        Province = "";
        if (Country != String.Empty && Country != "" && Country != null)
        {
            stateList = countryList.Where(a => a.CountryCode == Country).FirstOrDefault<Country>().ListState;
        }
    }


#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime JSRuntime { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IApiService apiService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private NavigationManager NavManager { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private NotificationService NotificationService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IProfileService ProfileService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private AppState appState { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private ILocalStorageService localStore { get; set; }
    }
}
#pragma warning restore 1591
